数据链路层使用“物理层”提供的“比特传输”服务  
数据链路层为网络层提供服务，将网络层的IP数据报（分组）封装成帧，传输给下一个相邻节点    
**物理链路**：传输介质（0层）+物理层（1层）实现了相邻节点之间的“物理链路”  
**逻辑链路**：数据链路层需要基于“物理链路”，实现相邻结点之间逻辑上无差错的“数据链路”  

---
# 功能
+ 封装成帧：
	+ 帧定界：如何让接收方能够确定帧的界限
	+ 透明传输：接收方链路层要能从收到的帧内恢复原始SDU，让网络层“感受不到”将分组封装成帧的过程
+ 差错控制：发现并解决一个帧内部的“位错”
	+ 解决方案一：接收方发现比特错后丢弃帧，发送方重传帧（仅需采用检错编码）
	+ 解决方案二：由接收方发现并纠正比特错误（需采用纠错编码）
+ 可靠传输：发现并解决“帧错”（帧丢失、帧重复、帧失序）
+ 流量控制：控制发送方发送帧的速率别太快，让接收方“来得及”接受
+ 介质访问控制：
	+ “广播信道”需要实现此功能。广播信道在逻辑上是总线型拓扑，多个结点需争抢传输介质的使用权
	+ “点对点信道”通常不需要实现此功能。点对点信道通常意味着两个节点之间有专属介质，不用抢
---
# 组帧
+ 字符计数法：在每个帧开头，用一个定长计数字段表示帧长
	+ 缺点：任何一个技术字段出错，都会导致后续所有帧无法定界
+ 字节填充法：使用SOH和EOT控制字符表示一帧的开始与结束，通常会使用ESC转义字符避免帧中出现控制字符导致扫描出错。
+ 零比特填充法（HDLC、PPP）：使用比特串01111110来标志一帧的开始和结束
	+ 发送方需要对帧的数据部分进行处理，*每当遇到5个1，就填充一个0*
	+ 接收方需要对帧的数据部分进行逆处理，*每当遇到连续5个1，就删掉后面的0*
+ 违规编码法：需要物理层配合，对采用的信号传输方式使用违规的信号编码，例如基于曼彻斯特码，每一个信号是观察信号是否跳变，当信号不进行跳变时则“违规”，将其表示帧的开始或结束
---
# 差错控制
### 奇偶校验码
奇（偶）校验码：整个校验码（有效信息为何校验位）中“1”的个数为奇（偶）数    
奇校验：检查信息位中“1”的个数为偶数则校验位为1，为奇数则检验位为0（偶校验相反）  
偶校验的硬件实现：各信息进行异或运算，得到的结果即为偶校验位  
缺点：只能检测奇数位出现错误的情况，并且不知道哪些位出错
### 循环冗余码（CRC）
思想：数据发送、接收方约定为一个“除数”，K个信息位+R个校验位作为“被除数”，添加校验位后需保证出发的余数为0，然后接收方进行除法检测余数是否为0，非0即需要重传或者纠错  
基本思想：
1. 收发双方约定生成多项式G(x)（最高位和最低位必须为1），k位位串可视为阶数为k-1的多项式的系数序列。例如，可用多项式$x^3+x^2+1$表示位串1101
2. 发送方基于待发送的数据和G(x)，计算冗余码，将冗余码附加到数据后面一起发送
3. 接收方收到数据和冗余码后，通过G(x)来计算收到的数据和冗余码是否产生差错

检错能力：
+ 可检测出所有格奇数个错误
+ 可检测出所有双比特的错误
+ 可检测出所有小于等于检验位长度的连续错误
+ 若选择合适的生成多项式，且$2^R\geq K+R+1$,则可纠正单比特错误
### 海明校验码
1. 确定海明码位数：n为有效信息位数，k为校验位的位数，则信息位n和校验位k应满足$n+k+1\leq2^k-1$
2. 确定校验位的分布，校验位$P_i$放在海明位号为$2^{i-1}$的位置上，信息位按顺序放到其余位置
3. 分组以形成校验关系：被检验数据位的海明位号等于检验该数据位的各检验位海明位号之和
4. 检验位取值：检验位$P_i$的值为第i组所有位求异或
5. 构造校验方程：G1 = P1 ⊕ D1 ⊕ D2 ⊕ D4 ；G2 = P2 ⊕ D1 ⊕ D3 ⊕ D4；G3 = P3 ⊕ D2 ⊕ D3 ⊕ D4等，最后由“G3G2G1”的值进行判断，若为“000”，则正确，若为“001”，则第一位发生了错误

综上所述，海明码纠错能力只有1位，检错能力可以检错2位    
海明码“纠错”d位，需要码距2d+1的编码方案；“检错”d位，则只需码距为d+1  

---
# 流量控制与可靠传输机制
$W_T+W_R\leq2^n$  
## 停止等待协议（S-W）
原理：发送方每次只允许发送一个帧，接收方每接收一个帧都要反馈一个应答信号，表示可以接受下一帧，发送方收到应答信号后才能发送下一帧。若发送方没有收到接收方反馈的应答信号，则需要一直等待。发送方每发送完一个帧，就进入等待接收方确认信息的过程中，因而传输效率很低。  
![](assets/SW.png)
## 后退N帧协议（GBN）
在后退N帧协议中，发送方可在为收到确认帧的情况下，将序号在发送窗口内的多个数据帧全部发送出去。后退N帧的含义是：发送方发送N个数据帧后，若发现这N个帧的前一个数据帧在计时器超时的时候仍未收到其确认信息，则该帧被判为出错或丢失，此时发送方不得不重传该出错帧及随后的N个帧
![](assets/GBN.png)
## 选择重传协议（SR）
选择重传协议：用于在不可靠的网络中进行可靠数据传输。它允许发送方同时发送多个数据包，并在接收方接收到这些数据包后进行选择性的重传。只有丢失或损坏的数据包会被重新传输，而不需要重新传输整个数据流。`存在帧缓冲区，用于维持帧的顺序位次`  
1. 发送方将数据分成多个数据包，并分配唯一的序列号给每个数据包。
2. 发送方将这些数据包发送到接收方。
3. 接收方接收数据包，并根据序列号将它们按顺序重组。
4. 如果接收方检测到有丢失或损坏的数据包，它会向发送方发送一个选择性重传请求，请求重新发送仅丢失或损坏的数据包。
5. 发送方收到选择性重传请求后，仅重新发送被请求的数据包。
6. 这个过程不断重复，直到接收方成功接收所有数据包。

---
# 信道划分介质访问控制
信道划分介质访问控制：  将使用介质的每个设备与来自同一信道上的其他设备的通信隔离开，把时域和频域资源合理地分配给网路上的设备。  
多路复用技术：把多个信号组合在一条物理信道上进行传输，使得多个计算机或终端设备共享信道资源，提高信道利用率。  
分用：把一条广播信道，逻辑上分成几条用于两个节点之间通信的互不干扰的子信道，实际就是把广播信道转变为点对点信道。  
## 频分多路复用（FDM）
用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。频分复用的所有用户在同样的时间占用不同的带宽资源。  
优点：充分利用传输介质带宽，系统效率较高；由于技术比较成熟，实现也比较容易。  
## 时分多路复用（TDM）
将时间划分为一段段等长的时分复用帧。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙，所有用户轮流占用信道。  
统计时分复用（STDM）：每一个STDM帧中的时隙数小于连接在集中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后集中按顺序依次扫描输入缓存，把缓存中的输入数据放入STDM帧中，一个STDM帧满了就可以发出。STDM帧不是固定分配时隙，而是按需动态分配时隙。  
## 波分多路复用（WDM）
光的频分多路复用，在一根光纤中传输多种不同波长的光信号，由于波长不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来。  
## 码分多路复用（CDM）
码分多址（CDMA）：1个比特分为多个码片，每一个站点被指定一个唯一的m位的芯片序列。
1. 多个站点同时发送数据的时候，要求各个站点芯片序列相互正交，规格化内积为0.     $S·T=\frac{1}{m}\sum_{i=1}^{m}S_iT_i=0$
2. 两个向量到了公共信道，线性相加。  S-T
3. 数据分离：合并的数据和源站规格化内积$S·(S-T)=1 \ T·(S-T)=1$
